<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel — Mail.tm</title>
<style>
  body { font-family: Inter, system-ui, Arial,sans-serif; background:#f6f8fc; margin:0; padding:20px; }
  .box { background:#fff; padding:16px; border-radius:10px; border:1px solid #e6e9ef; max-width:400px; margin:auto; margin-top:50px; }
  .field { width:100%; padding:10px; border-radius:8px; border:1px solid #d6d9e3; margin-top:8px; }
  button.primary { background:#1a73e8; color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
  button.ghost { background:#fff; border:1px solid #d6d9e3; padding:8px 10px; border-radius:8px; cursor:pointer; margin-top:8px; }
  .status { font-size:13px; color:#6b7280; margin-top:8px; white-space:pre-wrap; }
</style>
</head>
<body>

<div class="box">
  <div style="font-weight:700;font-size:18px">Admin — Create Mail Account</div>
  <div class="small" style="margin-top:6px">Only admins can create accounts.</div>

  <label>New username (no domain)</label>
  <input id="adminNewUser" class="field" placeholder="username">

  <label>New password</label>
  <input id="adminNewPass" class="field" placeholder="password">

  <button class="primary" id="adminCreateBtn">Create Account</button>
  <div id="adminStatus" class="status"></div>
</div>

<script>
const el = id => document.getElementById(id);

el('adminCreateBtn').addEventListener('click', async ()=>{
  const user = (el('adminNewUser').value||'').trim().replace(/[^a-z0-9._-]/gi,'').toLowerCase();
  let pass = (el('adminNewPass').value||'').trim();
  if(!user){ el('adminStatus').innerText='Invalid username'; return; }
  if(pass.length < 8) pass += 'Aa1!234';
  el('adminStatus').innerText='Creating...';

  try{
    const dres = await fetch('https://api.mail.tm/domains');
    const djson = await dres.json();
    if(!djson['hydra:member'] || djson['hydra:member'].length===0){ el('adminStatus').innerText='No domains available'; return; }
    const domain = djson['hydra:member'][Math.floor(Math.random()*djson['hydra:member'].length)].domain;
    const address = `${user}@${domain}`;

    const cres = await fetch('https://api.mail.tm/accounts',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({address, password: pass})
    });
    if(!cres.ok){ const text = await cres.text(); el('adminStatus').innerText='Create error: '+text; return; }

    const tresp = await fetch('https://api.mail.tm/token',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({address, password: pass})
    });
    const tjson = await tresp.json();
    if(!tjson.token){ el('adminStatus').innerText='Created but token fetch failed'; return; }

    el('adminStatus').innerText=`Created ${address}\nToken: ${tjson.token}\nUse this for login.`;
  }catch(e){ el('adminStatus').innerText='Error: '+e; }
});
</script>

</body>
</html>
