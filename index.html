<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TempMail Gmail Clone</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#f6f8fc;}
.navbar {background:#fff;padding:12px;border-bottom:1px solid #ddd;display:flex;justify-content:space-between;align-items:center;font-weight:bold;}
.container {display:flex;height:calc(100vh - 50px);}
.sidebar {width:320px;background:#fff;border-right:1px solid #ddd;padding:10px;overflow-y:auto;}
.sidebar h3 {margin:10px 0;font-size:16px;color:#666;}
.inbox {flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;}
.message {background:#fff;margin-bottom:10px;padding:12px;border-radius:6px;border:1px solid #ddd;cursor:pointer;}
.message:hover {background:#f0f0f0;}
.box {width:360px;margin:80px auto;padding:30px;background:#fff;border:1px solid #ddd;border-radius:8px;text-align:center;}
input, button, textarea {width:90%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;}
button {background:#1a73e8;color:white;border:none;cursor:pointer;}
button:hover {background:#1669c1;}
#emailContent {background:#fff;padding:12px;border-radius:6px;border:1px solid #ddd;margin-bottom:10px;white-space:pre-wrap;flex:1;overflow-y:auto;}
#replyForwardButtons {margin-top:10px;}
#replyForwardButtons button {width:120px;margin-right:10px;}
</style>
</head>
<body>

<div class="navbar">
  <div>TempMail</div>
  <div>
    <button onclick="location.href='admin.html'">Admin Panel</button>
    <button onclick="location.href='support.html'">Support</button>
    <span id="userEmail" style="margin-left:15px;font-size:14px;"></span>
  </div>
</div>

<!-- Login -->
<div class="box" id="loginBox">
<h2>Login</h2>
<input type="text" id="loginUsername" placeholder="Full Email Address">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>
<div id="loginMessage"></div>
</div>

<!-- Mail App -->
<div class="container" id="mailApp" style="display:none;">
  <div class="sidebar">
    <h3>Send New Email</h3>
    <input type="text" id="toAddress" placeholder="To">
    <input type="text" id="emailSubject" placeholder="Subject">
    <textarea id="emailBody" placeholder="Message"></textarea>
    <button onclick="sendEmail()">Send</button>
    <div id="sendMessage"></div>
    <h3>Inbox</h3>
    <div id="messages"></div>
  </div>
  <div class="inbox">
    <h2>Email Content</h2>
    <div id="emailContent">Click a message to view its content</div>
    <div id="replyForwardButtons" style="display:none;">
      <button onclick="replyEmail()">Reply</button>
      <button onclick="forwardEmail()">Forward</button>
    </div>
  </div>
</div>

<script>
let token="", account={}, selectedMessage=null;
const backendURL="/api/send";

async function login(){
  let username=document.getElementById("loginUsername").value.trim();
  let password=document.getElementById("loginPassword").value.trim();
  if(!username||!password){document.getElementById("loginMessage").innerText="Fill all fields"; return;}
  account={address:username,password};
  try{
    const r=await fetch("https://api.mail.tm/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(account)});
    const data=await r.json();
    if(data.token){
      token=data.token;
      document.getElementById("loginBox").style.display="none";
      document.getElementById("mailApp").style.display="flex";
      document.getElementById("userEmail").innerText=account.address;
      fetchMessages();
      setInterval(fetchMessages,5000);
    } else {
      document.getElementById("loginMessage").innerText="Login failed";
    }
  }catch(e){
    document.getElementById("loginMessage").innerText="Error: "+e;
  }
}

async function fetchMessages(){
  try{
    const r=await fetch("https://api.mail.tm/messages",{headers:{Authorization:"Bearer "+token}});
    const data=await r.json();
    const messagesDiv=document.getElementById("messages");
    messagesDiv.innerHTML="";
    data["hydra:member"].forEach(msg=>{
      let div=document.createElement("div");
      div.className="message";
      div.innerHTML=`<b>${msg.from.address}</b><br>${msg.subject||"(no subject)"}<br><small>${new Date(msg.createdAt).toLocaleString()}</small>`;
      div.onclick=()=>showMessage(msg.id);
      messagesDiv.appendChild(div);
    });
  }catch(e){}
}

async function showMessage(id){
  try{
    const r=await fetch(`https://api.mail.tm/messages/${id}`,{headers:{Authorization:"Bearer "+token}});
    const msg=await r.json();
    selectedMessage=msg;
    document.getElementById("emailContent").innerHTML=`<b>From:</b> ${msg.from.address}<br><b>Subject:</b> ${msg.subject||"(no subject)"}<hr>${msg.text}`;
    document.getElementById("replyForwardButtons").style.display="block";
  }catch(e){}
}

async function sendEmail(){
  const to=document.getElementById("toAddress").value.trim();
  const subject=document.getElementById("emailSubject").value.trim();
  const text=document.getElementById("emailBody").value.trim();
  if(!to||!text){document.getElementById("sendMessage").innerText="Fill all fields";return;}
  try{
    const r=await fetch(backendURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token,from:account.address,to,subject,text})});
    const data=await r.json();
    if(data.id){document.getElementById("sendMessage").innerText="Email sent!";document.getElementById("toAddress").value="";document.getElementById("emailSubject").value="";document.getElementById("emailBody").value="";}
    else{document.getElementById("sendMessage").innerText="Error: "+JSON.stringify(data);}
  }catch(e){document.getElementById("sendMessage").innerText="Error: "+e;}
}

function replyEmail(){
  if(!selectedMessage) return;
  document.getElementById("toAddress").value=selectedMessage.from.address;
  document.getElementById("emailSubject").value="Re: "+(selectedMessage.subject||"(no subject)");
  document.getElementById("emailBody").value="\n\n---- Original message ----\n"+selectedMessage.text;
}

function forwardEmail(){
  if(!selectedMessage) return;
  document.getElementById("toAddress").value="";
  document.getElementById("emailSubject").value="Fwd: "+(selectedMessage.subject||"(no subject)");
  document.getElementById("emailBody").value="\n\n---- Forwarded message ----\nFrom: "+selectedMessage.from.address+"\n"+selectedMessage.text;
}
</script>
</body>
</html>
