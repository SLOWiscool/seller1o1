<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Mail</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
    .container { max-width: 600px; margin:50px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    h2 { text-align:center; }
    input, button { width:100%; padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:5px; }
    button { background:#007bff; color:#fff; cursor:pointer; }
    button:hover { background:#0056b3; }
    #inbox { margin-top:20px; }
    .email { border-bottom:1px solid #ddd; padding:10px; }
    .email:last-child { border:none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Secure Mail</h2>

    <!-- Signup -->
    <div id="signup">
      <h3>Create Account</h3>
      <input type="text" id="newUser" placeholder="Username (e.g. john)">
      <input type="password" id="newPass" placeholder="Password">
      <button onclick="signup()">Sign Up</button>
    </div>

    <!-- Login -->
    <div id="login">
      <h3>Login</h3>
      <input type="text" id="loginUser" placeholder="Username (e.g. john)">
      <input type="password" id="loginPass" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>

    <!-- Inbox -->
    <div id="inbox" style="display:none;">
      <h3>Your Inbox</h3>
      <button onclick="loadInbox()">Refresh Inbox</button>
      <div id="emails"></div>
    </div>
  </div>

  <script>
    let token = "";
    const domain = "mail.tm";

    async function signup() {
      const user = document.getElementById("newUser").value;
      const pass = document.getElementById("newPass").value;
      const email = user + "@" + domain;

      const res = await fetch("https://api.mail.tm/accounts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: email, password: pass })
      });
      if (res.ok) {
        alert("Account created! You can now log in.");
      } else {
        const err = await res.json();
        alert("Error: " + err.detail);
      }
    }

    async function login() {
      const user = document.getElementById("loginUser").value;
      const pass = document.getElementById("loginPass").value;
      const email = user + "@" + domain;

      const res = await fetch("https://api.mail.tm/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: email, password: pass })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById("inbox").style.display = "block";
        loadInbox();
      } else {
        alert("Login failed: " + data.detail);
      }
    }

    async function loadInbox() {
      const res = await fetch("https://api.mail.tm/messages", {
        headers: { Authorization: "Bearer " + token }
      });
      const data = await res.json();
      const box = document.getElementById("emails");
      box.innerHTML = "";
      if (data["hydra:member"].length === 0) {
        box.innerHTML = "<p>No messages yet.</p>";
        return;
      }
      data["hydra:member"].forEach(msg => {
        box.innerHTML += `
          <div class="email">
            <b>From:</b> ${msg.from.address}<br>
            <b>Subject:</b> ${msg.subject}<br>
            <small>${msg.intro}</small>
          </div>`;
      });
    }
  </script>
</body>
</html>
