<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mail Portal Demo</title>
<style>
body { font-family: Arial; margin:20px; text-align:center; }
input, button { margin:5px; padding:8px; width:90%; max-width:400px; }
.hidden { display:none; }
</style>
</head>
<body>

<h1>Mail Portal Demo</h1>

<div id="dashboard" class="hidden">
  <h2>Dashboard</h2>
  <p id="email-display"></p>
  <button onclick="logout()">Logout</button>
</div>

<div id="login-section">
  <button onclick="createRandomAccount()">Create Random Account & Login</button>
  <p id="status-msg"></p>
</div>

<script>
let jwt="", currentEmail="";

async function createRandomAccount(){
  document.getElementById("status-msg").innerText="Creating account...";
  try{
    const res=await fetch("/api/send.js",{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:"create-random"})
    });
    const data=await res.json();
    if(data.token){
      jwt=data.token;
      currentEmail=data.email;
      document.getElementById("email-display").innerText="Logged in as: "+data.email;
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("status-msg").innerText="Account created and logged in!";
    } else {
      document.getElementById("status-msg").innerText="Failed: "+JSON.stringify(data);
    }
  } catch(err){
    document.getElementById("status-msg").innerText="Error: "+err.message;
  }
}

function logout(){
  jwt="";
  currentEmail="";
  document.getElementById("dashboard").classList.add("hidden");
  document.getElementById("login-section").classList.remove("hidden");
  document.getElementById("status-msg").innerText="";
}
</script>
</body>
</html>
