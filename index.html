<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TempMail Gmail Clone</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#f6f8fc;}
.navbar {background:#fff;padding:12px;border-bottom:1px solid #ddd;font-weight:bold;}
.container {display:flex;height:calc(100vh - 50px);}
.sidebar {width:250px;background:#fff;border-right:1px solid #ddd;padding:10px;}
.sidebar h3 {margin:10px 0;font-size:16px;color:#666;}
.inbox {flex:1;padding:20px;overflow-y:auto;}
.message {background:#fff;margin-bottom:10px;padding:12px;border-radius:6px;border:1px solid #ddd;cursor:pointer;}
.message:hover {background:#f0f0f0;}
.box {width:360px;margin:80px auto;padding:30px;background:#fff;border:1px solid #ddd;border-radius:8px;text-align:center;}
input, button {width:90%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;}
button {background:#1a73e8;color:white;border:none;cursor:pointer;}
button:hover {background:#1669c1;}
</style>
</head>
<body>
<div class="navbar">TempMail</div>

<!-- Signup Form -->
<div class="box" id="signupBox">
<h2>Create Account</h2>
<input type="text" id="signupUsername" placeholder="Choose a username">
<input type="password" id="signupPassword" placeholder="Choose a password">
<button onclick="createAccount()">Create Account</button>
<p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
<div id="signupMessage"></div>
</div>

<!-- Login Form -->
<div class="box" id="loginBox" style="display:none;">
<h2>Login</h2>
<input type="text" id="loginUsername" placeholder="Username">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>
<p>Donâ€™t have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
<div id="loginMessage"></div>
</div>

<!-- Mail App -->
<div class="container" id="mailApp" style="display:none;">
<div class="sidebar">
<h3>Inbox</h3>
<div id="userEmail" style="font-size:13px;color:#444;margin-top:5px;"></div>
</div>
<div class="inbox">
<h2>Your Emails</h2>
<div id="messages"></div>
</div>
</div>

<script>
let token = "";
let address = "";
let account = {};

function showLogin(){
  document.getElementById("signupBox").style.display="none";
  document.getElementById("loginBox").style.display="block";
}
function showSignup(){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("signupBox").style.display="block";
}

async function createAccount(){
  // sanitize username
  let username = document.getElementById("signupUsername").value.trim().replace(/[^a-z0-9._-]/gi,'').toLowerCase();
  let password = document.getElementById("signupPassword").value.trim();
  if(!username) {document.getElementById("signupMessage").innerText="Invalid username."; return;}
  if(password.length < 8) {password="Aa123456!";} // strong default password

  // get random domain
  const res = await fetch("https://api.mail.tm/domains");
  const data = await res.json();
  const domain = data["hydra:member"][Math.floor(Math.random()*data["hydra:member"].length)].domain;

  address = `${username}@${domain}`;
  account = {address, password};

  // create account
  let r = await fetch("https://api.mail.tm/accounts",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(account)
  });

  if(r.ok){
    document.getElementById("signupMessage").innerText=`Account created: ${address}. Waiting for verification...`;
    await waitForVerification();
  } else {
    let err = await r.json();
    document.getElementById("signupMessage").innerText="Error: "+JSON.stringify(err);
  }
}

// wait for token (auto-login)
async function waitForVerification(){
  let verified=false;
  while(!verified){
    await new Promise(r=>setTimeout(r,3000)); // wait 3 sec
    let r = await fetch("https://api.mail.tm/token",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(account)
    });
    let data = await r.json();
    if(data.token){token=data.token;verified=true;break;}
  }
  document.getElementById("signupMessage").innerText="Verified! Logging in...";
  loginAfterSignup();
}

function loginAfterSignup(){
  document.getElementById("signupBox").style.display="none";
  document.getElementById("mailApp").style.display="flex";
  document.getElementById("userEmail").innerText=account.address;
  fetchMessages();
  setInterval(fetchMessages,5000);
}

async function login(){
  let username=document.getElementById("loginUsername").value.trim();
  let password=document.getElementById("loginPassword").value.trim();
  username=username.replace(/[^a-z0-9._-]/gi,'').toLowerCase();
  account={address:username,password};
  let r = await fetch("https://api.mail.tm/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(account)});
  let data = await r.json();
  if(data.token){token=data.token;document.getElementById("loginBox").style.display="none";document.getElementById("mailApp").style.display="flex";document.getElementById("userEmail").innerText=account.address;fetchMessages();setInterval(fetchMessages,5000);}
  else{document.getElementById("loginMessage").innerText="Login failed";}
}

async function fetchMessages(){
  let r = await fetch("https://api.mail.tm/messages",{headers:{Authorization:"Bearer "+token}});
  let data = await r.json();
  const messagesDiv=document.getElementById("messages");
  messagesDiv.innerHTML="";
  data["hydra:member"].forEach(msg=>{
    let div=document.createElement("div");
    div.className="message";
    div.innerHTML=`<b>${msg.from.address}</b><br>${msg.subject||"(no subject)"}`;
    messagesDiv.appendChild(div);
  });
}
</script>
</body>
</html>
